import{bA as ke,c as ne,h as O,bB as te,g as qe,r,aJ as i,a6 as R,d as l,bb as u,u as n,Q as s,a4 as b,bE as Q,a7 as m,a5 as E,ad as d,bD as Y,N as Qe}from"./index.2bde107a.js";import{Q as ae}from"./QSpace.9e0724bd.js";import{Q as Ve}from"./QToggle.226f8cfe.js";import{Q as se}from"./QToolbar.3aa20603.js";import{u as we,a as he,Q as ie,h as F,b as G}from"./helpers.5b8cfde7.js";import{Q as c}from"./QTd.5d1d3602.js";import{Q as Pe}from"./QBadge.e812789d.js";import{Q as Ce}from"./QTr.8bfe9184.js";import{Q as N}from"./QInput.23cab2f6.js";import{Q as Se,a as le}from"./QTable.aea3afe4.js";import{Q as xe}from"./QCardActions.ee7de190.js";import{Q as Ae}from"./QDialog.68e40b65.js";import{e as Be,a as De}from"./excel.5d19a2ad.js";import{a as Ue}from"./use-quasar.dc4235cf.js";import{a as Ee,u as J}from"./index.6a80c9ab.js";import{p as de}from"./product_columns.0707d543.js";import{u as Ne}from"./product-store.4f7e0f86.js";import{u as $e}from"./category-store.49916d0f.js";import{u as Te}from"./measurement-store.14ac8233.js";import{u as Ie}from"./department-store.66ba10d9.js";import{u as Me}from"./auth-store.13aee4b3.js";import"./use-key-composition.dcc0853f.js";import"./module_calls.b67ca1a8.js";import"./QList.c5e9bb29.js";import"./rtl.d38ebc78.js";var ze=ke({name:"QBanner",props:{...we,inlineActions:Boolean,dense:Boolean,rounded:Boolean},setup(V,{slots:v}){const{proxy:{$q:M}}=qe(),k=he(V,M),w=ne(()=>"q-banner row items-center"+(V.dense===!0?" q-banner--dense":"")+(k.value===!0?" q-banner--dark q-dark":"")+(V.rounded===!0?" rounded-borders":"")),z=ne(()=>`q-banner__actions row items-center justify-end col-${V.inlineActions===!0?"auto":"all"}`);return()=>{const j=[O("div",{class:"q-banner__avatar col-auto row items-center self-start"},te(v.avatar)),O("div",{class:"q-banner__content col text-body2"},te(v.default))],$=te(v.action);return $!==void 0&&j.push(O("div",{class:z.value},$)),O("div",{class:w.value+(V.inlineActions===!1&&$!==void 0?" q-banner--top-padding":""),role:"alert"},j)}}});const je={class:"q-pa-md"},Le={key:0,class:"q-ml-sm"},Oe={key:0},Re={key:1},Ye={class:"text-h6"},Fe=m("small",null,[m("b",null,"Product Quantity should be adjusted from inventories.")],-1),Ge={style:{"background-color":"rgb(197, 238, 206)",padding:"3px"}},Je={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},He={class:"row q-col-gutter-sm q-mb-sm q-pa-md"},Ke={class:"text-center error_msg"},Qt={__name:"Products",setup(V){const v=Me(),M=Ue(),k=Ee(),w=Ne(),z=$e(),j=Te(),$=Ie(),T=r(!1),h=r(!1),P=r(!1),I=r(!1),H=r(""),L=r(""),ue=r(""),q=r(""),_=r(""),C=r(0),S=r(0),x=r(1),A=r(1),{data:K,isLoading:ce,isError:oe}=J("products",()=>w.fetchProducts()),B=r("");let W=r([]);const D=r("");let X=r([]);const U=r("");let Z=r([]);J("categories",()=>z.fetchCategories(),{onSuccess:a=>{X.value=a.map(e=>({uuid:e.uuid,name:e.name}))}}),J("measurements",()=>j.fetchMeasurements(),{onSuccess:a=>{W.value=a.map(e=>({uuid:e.uuid,name:e.name}))}}),J("departments",()=>$.fetchDepartments(),{onSuccess:a=>{Z.value=a.map(e=>({uuid:e.uuid,name:e.name}))}});const me=async a=>{if(confirm(`Continue with the operation. Delete ${a.name} ?`)){const t=await w.deleteProduct({uuid:a.uuid});t.status==="success"?(k.refetchQueries("products"),p(t.message,"green","top")):p("There was an error","red","top-right")}},pe=()=>{h.value=!1,z.categories.length===0?p("You need to create at least one CATEGORY in order to create products!","orange","top"):(L.value="Add New Product",T.value=!0)},ve=a=>{h.value=!0,L.value=`Edit ${a.name}`,ue.value=a.uuid,T.value=!0,_.value=a.name,C.value=a.quantity,S.value=a.min_quantity,x.value=a.buying_price,A.value=a.selling_price,B.value=W.value.find(e=>e.name===a.measurement),D.value=X.value.find(e=>e.name===a.category),U.value=Z.value.find(e=>e.name===a.department)},_e=async()=>{q.value="",P.value=!0;const a={name:_.value.trim(),quantity:C.value,min_quantity:Number(S.value),selling_price:A.value,buying_price:x.value,category_uuid:D.value.uuid,department_uuid:U.value.uuid,measurement_uuid:B.value.uuid};if(a.name&&a.quantity&&a.min_quantity&&a.selling_price&&a.buying_price&&a.category_uuid&&a.department_uuid&&a.measurement_uuid){const e=await w.createProduct(a);e.status==="success"?(k.refetchQueries("products"),k.refetchQueries("finished_products"),ee(),p(e.message,"green","top")):(q.value=e.message,p(e.message,"red","top-right"))}else q.value="All fields are required!",P.value=!1,p("All fields are required!","red","top-right")},fe=async()=>{q.value="",P.value=!0;const a={product_uuid:ue.value,name:_.value.trim(),quantity:C.value,min_quantity:Number(S.value),selling_price:A.value,buying_price:x.value,category_uuid:D.value.uuid,department_uuid:U.value.uuid,measurement_uuid:B.value.uuid};if(a.name&&a.quantity&&a.selling_price&&a.buying_price&&a.category_uuid&&a.department_uuid&&a.measurement_uuid){const e=await w.updateProduct(a);e.status==="success"?(k.refetchQueries("products"),k.refetchQueries("finished_products"),ee(),p(e.message,"green","top")):p(e.message,"red","top-right")}else q.value="All fields are required!",p("All fields are required!","red","top-right")},ye=()=>ee(),p=(a,e,t)=>{M.notify({message:a,color:e,position:t})},ee=()=>{_.value="",A.value=1,x.value=1,D.value="",U.value="",B.value="",C.value=1,S.value=0,T.value=!1,P.value=!1,h.value=!1,L.value="",q.value=""},ge=a=>{const e=a.map(t=>({name:t.name,products:t.products.length,created_at:t.created_at}));Be(e,de,De,M,"ProductsData")};return(a,e)=>(i(),R("div",je,[l(ie,{dark:"",class:"bg-primary q-mb-sm q-pa-none"},{default:u(()=>[l(se,null,{default:u(()=>{var t,f,y,o;return[l(Q,{dense:"",flat:"",icon:"arrow_back",label:"Back",onClick:e[0]||(e[0]=g=>a.$router.back())}),l(ae),m("span",null,[l(Ve,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=g=>I.value=g),"checked-icon":"check",color:"orange","unchecked-icon":"clear",label:`${I.value?"Table View.":"Mobile View."}`},null,8,["modelValue","label"])]),!I.value&&n(F)((y=(f=(t=n(v))==null?void 0:t.user)==null?void 0:f.user)==null?void 0:y.roles)?(i(),R("span",Le,[l(Q,{onClick:pe,dense:"",color:"orange",size:"sm",icon:"add",label:"Add Product",unelevated:""}),((o=n(K))==null?void 0:o.length)>0?(i(),b(Q,{key:0,dense:"",outline:"",icon:"archive",label:"Export Products",class:"q-ml-sm",size:"sm",onClick:e[2]||(e[2]=g=>ge(n(K)))})):E("",!0)])):E("",!0)]}),_:1})]),_:1}),n(ce)?(i(),R("div",Oe,"Loading products...")):n(oe)?(i(),R("div",Re,"An error has occurred: "+s(n(oe)),1)):(i(),b(Se,{key:2,title:"All Products",rows:n(K),columns:n(de),separator:"cell","row-key":"name",filter:H.value,dense:"",grid:I.value},{body:u(t=>[l(Ce,{props:t,class:Qe(`${t.row.quantity<=t.row.min_quantity||t.row.quantity<1?"blink-bg":""}`)},{default:u(()=>{var f,y,o;return[l(c,{key:"name",props:t},{default:u(()=>[d(s(t.row.name),1)]),_:2},1032,["props"]),l(c,{key:"measurement",props:t},{default:u(()=>[d(s(t.row.measurement)+" ",1),m("small",null,[l(Pe,null,{default:u(()=>[d(": "+s(t.row.quantity),1)]),_:2},1024)])]),_:2},1032,["props"]),l(c,{key:"min_quantity",props:t},{default:u(()=>[d(s(t.row.min_quantity),1)]),_:2},1032,["props"]),l(c,{key:"buying_price",props:t},{default:u(()=>[d(s(t.row.buying_price),1)]),_:2},1032,["props"]),l(c,{key:"selling_price",props:t},{default:u(()=>[d(s(t.row.selling_price),1)]),_:2},1032,["props"]),l(c,{key:"department",props:t},{default:u(()=>[d(s(t.row.department),1)]),_:2},1032,["props"]),l(c,{key:"category",props:t},{default:u(()=>[d(s(t.row.category),1)]),_:2},1032,["props"]),l(c,{key:"user",props:t},{default:u(()=>[d(s(t.row.user),1)]),_:2},1032,["props"]),l(c,{key:"created_at",props:t},{default:u(()=>[d(s(t.row.created_at),1)]),_:2},1032,["props"]),n(F)((o=(y=(f=n(v))==null?void 0:f.user)==null?void 0:y.user)==null?void 0:o.roles)?(i(),b(c,{key:"actions",props:t},{default:u(()=>[l(Y,{color:"blue",name:"edit",onClick:g=>ve(t.row),style:{cursor:"pointer"},size:"20px",class:"q-mr-md"},null,8,["onClick"]),l(Y,{color:"red",name:"delete",onClick:g=>me(t.row),style:{cursor:"pointer"},size:"20px"},null,8,["onClick"])]),_:2},1032,["props"])):E("",!0)]}),_:2},1032,["props","class"])]),"top-right":u(()=>[l(N,{borderless:"",dense:"",outlined:"",rounded:"",debounce:"300",modelValue:H.value,"onUpdate:modelValue":e[3]||(e[3]=t=>H.value=t),placeholder:"Search product",class:"q-mr-md",clearable:""},{append:u(()=>[l(Y,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","columns","filter","grid"])),l(Ae,{modelValue:T.value,"onUpdate:modelValue":e[12]||(e[12]=t=>T.value=t),persistent:""},{default:u(()=>[l(ie,{style:{width:"500px"}},{default:u(()=>{var t,f,y;return[l(G,null,{default:u(()=>[m("div",Ye,s(L.value),1)]),_:1}),l(G,{class:"q-pt-none"},{default:u(()=>[l(N,{outlined:"",dense:"",label:"Name",modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=o=>_.value=o)},null,8,["modelValue"])]),_:1}),l(G,{class:"q-pt-none"},{default:u(()=>{var o,g,re;return[!h.value&&n(F)((re=(g=(o=n(v))==null?void 0:o.user)==null?void 0:g.user)==null?void 0:re.roles)?(i(),b(N,{key:0,outlined:"",dense:"",label:"Initial Quantity",modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=be=>C.value=be),type:"number",min:"1",oninput:"validity.valid||(value='')"},null,8,["modelValue"])):(i(),b(ze,{key:1,class:"bg-primary text-white"},{default:u(()=>[l(se,null,{default:u(()=>[Fe,l(ae),l(Q,{label:"INVENTORIES",outline:"",size:"sm",to:"/inventories"})]),_:1})]),_:1}))]}),_:1}),m("div",Ge,[n(F)((y=(f=(t=n(v))==null?void 0:t.user)==null?void 0:f.user)==null?void 0:y.roles)?(i(),b(N,{key:0,outlined:"",dense:"",label:"Minimum Quantity",modelValue:S.value,"onUpdate:modelValue":e[6]||(e[6]=o=>S.value=o),type:"number",min:"0",oninput:"validity.valid||(value='');",class:"q-ma-md",filled:"",hint:"Minimum Quantity that will prompt for product restock..."},{prepend:u(()=>[l(Y,{name:"blur_on"})]),_:1},8,["modelValue"])):E("",!0)]),m("div",Je,[l(N,{outlined:"",dense:"",label:"Buying Price (Per Unit)",modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=o=>x.value=o),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"]),l(N,{outlined:"",dense:"",label:"Selling Price (Per Unit)",modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=o=>A.value=o),type:"number",min:"1",oninput:"validity.valid||(value='');",class:"col-6"},null,8,["modelValue"])]),m("div",He,[l(le,{dense:"",outlined:"",modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=o=>D.value=o),options:n(X),"option-value":"uuid","option-label":"name",label:"Select Product Category",class:"col-6"},null,8,["modelValue","options"]),l(le,{dense:"",outlined:"",modelValue:B.value,"onUpdate:modelValue":e[10]||(e[10]=o=>B.value=o),options:n(W),"option-value":"uuid","option-label":"name",label:"Select Product Measurement",class:"col-6"},null,8,["modelValue","options"])]),l(G,{class:"q-pt-none"},{default:u(()=>[l(le,{dense:"",outlined:"",modelValue:U.value,"onUpdate:modelValue":e[11]||(e[11]=o=>U.value=o),options:n(Z),"option-value":"uuid","option-label":"name",label:"Select Product Department"},null,8,["modelValue","options"])]),_:1}),m("div",Ke,[m("small",null,s(q.value),1)]),l(xe,{align:"right"},{default:u(()=>[l(Q,{flat:"",label:"Cancel",color:"red",onClick:ye}),l(ae),_.value&&!h.value?(i(),b(Q,{key:0,flat:"",label:"Add Product",color:"primary",onClick:_e,loading:P.value},null,8,["loading"])):E("",!0),_.value&&h.value?(i(),b(Q,{key:1,flat:"",label:"Edit Product",color:"primary",onClick:fe,loading:P.value},null,8,["loading"])):E("",!0)]),_:1})]}),_:1})]),_:1},8,["modelValue"])]))}};export{Qt as default};
